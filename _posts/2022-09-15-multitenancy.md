---
title: 멀티테넌시 아키텍처
categories: [Computer engineering, Cloud infrastructure]
tags: [infrastructure, multitenancy, 인프라, 멀티테넌시]
---

네이버클라우드에서 인턴십을 하며 공부한 내용을 정리하는 첫 번째 포스팅 시간입니다. 이번 포스팅에서는 멀티테넌시 아키텍처에 대해 알아보도록 하겠습니다.

## 멀티테넌시

멀티테넌시(Multitenancy)는 단일 소프트웨어 인스턴스로 서로 다른 여러 사용자 그룹에 독립적으로 서비스를 제공할 수 있는 소프트웨어 아키텍처를 말합니다. 대표적으로 SaaS(Software as a Service)가 멀티테넌트 아키텍처의 예입니다.

클라우드 컴퓨팅에서는 Software 뿐만 아니라 서로 다른 고객이 Hardware 자원인 서버 리소스를 독립적으로 나누어 사용하는 공유 호스팅을 멀티테넌시라고 부르기도 합니다.

멀티테넌시의 반대 개녀으로 단일 테넌시가 있는데 이는 소프트웨어 인스턴스 혹은 컴퓨터 시스템 하나에 최종 사용자 또는 사용자 그룹이 하나만 있는 것을 의미합니다. 

## 멀티테넌시의 기원

사실 멀티테넌시 개념은 오래 전에 등장했습니다. 컴퓨터 장비가 비쌌던 과거에 여러 사용자가 동시에 컴퓨터를 사용할 수 있도록 시분할 소프트웨어를 개발했는데 이것이 사라지지 않고 자리잡아 오늘날 클라우드 컴퓨팅의 근간으로 자리매김 하였습니다. Public Cloud에서는 공유 리소스(프로세싱 성능 및 메모리)의 풀을 구성한 뒤 여러 테넌트에 분할하여 제공합니다. 즉, 각 테넌트의 데이터 및 워크로드는 동일한 machine 또는 machine group에서 실행되더라도 서로 분리된 상태를 유지합니다.

이러한 아이디어를 발전시켜 소프트웨어 아키텍처에 적용한 것이 SaaS 개념입니다. SasS 제공 업체는 애플리케이션의 단일 인스턴스를 실행하여 개별 고객들에게 독립적인 액세스를 제공합니다. 하지만 각 사용자의 데이터는 계속 분리되어 있습니다.

쿠버네티스와 같은 컨테이너 오케스트레이션 플랫폼에서는 멀티테넌시라는 용어를 대개 여러 개의 프로젝트를 서비스하는 단일 클러스터를 의미하도록 사용하곤 합니다. 이 클러스터는 각 프로젝트를 서로 분리 실행하도록 설정되어 있습니다.

## 멀티테넌시 vs 클라우드 컴퓨팅

위에서 알아본 것처럼 멀티테넌시는 다중 테넌트에 제공되는 소프트웨어 애플리케이션의 단일 인스턴스를 의미하며 주로 SaaS 애플리케이션과 연결되는 개념입니다. 이와 반대로, 클라우드 서비스 자체는 PaaS(Platform as a service)로 간주됩니다.

클라우드 서비스 제공업체는 여러 사용자(혹은 테넌트)에게 할당되는 리소스 풀에서 클라우드 컴퓨팅에 필요한 플랫폼과 기반이 되는 IT 인프라를 사용자에게 함께 제공합니다. 클라우드 플랫폼 아키텍처를 구성하기 위해서 컨테이너화, 오케스트레이션, 애플리케이션 프로그래밍 인터페이스(API), 라우팅, 보안, 관리, 자동화 소프트웨어 등을 포함하는 추가적인 개발이 필요합니다.

클라우드 아키텍처는 아래와 같이 2 종류로 나누어 생각할 수 있습니다.

1. Public Cloud Architecture: 최종 사용자가 소유하지 않은 리소스에서 생성되고 다른 테넌트에 재배포 가능한 클라우드 환경입니다.

2. Private Cloud Architecture: 최종 사용자 전용 클라우드 환경으로, 대개는 사용자의 방화벽 내에 있으며 가끔 온프레미스에 있기도 합니다.

## 멀티테넌트 아키텍처의 장점

1. 멀티테넌시의 비용 절감 효과: 멀티테넌시에서는 효율적으로 리소스를 통합하고 할당하여 운영 비용을 절감할 수 있습니다. 개별 사용자 입장에서 클라우드 서비스 또는 SaaS 애플리케이션에 대한 사용 비용을 지불하는 것이 단일 테넌트 하드웨어 및 소프트웨어를 운영하는 것보다 경제적일 때가 많습니다.

2. 멀티테넌시의 유연성: 멀티테넌트 클라우드에서는 사용자의 리소스 수요 증감에 맞춰 필요한 사용자에게 리소스 풀을 유동적으로 할당할 수 있습니다. 

3. 멀티테넌시의 효율성: 멀티테넌시에서는 개별 사용자가 인프라를 관리하고 업데이트 및 유지 작업을 하는 일이 많이 줄어듭니다. 이런 작업은 중앙의 클라우드 제공업체가 대신 처리해줍니다.

## 단일 테넌트를 선호하는 경우

멀티테넌시의 장점도 많지만 리소스를 공유하여 사용하다보니 고도로 민감한 데이터를 다루는 애플리케이션에서는 보안의 이유로 단일 테넌트를 사용하기도 합니다. 사실 이론상으로는 클라우드 환경에서 크로스 테넌트 공격을 허용하는 취약점이 존재하긴 하지만 이러한 위험성은 사실 굉장히 미미한 수준입니다. 미국 국가안보국 NSA의 보고서에 따르면 아직까지 주요 퍼블릭 클라우드 제공업체 중에서 어디서도 크로스 테넌트 공격이 발생했다는 기록은 없습니다. 오히려 부실한 액세스 제어나 설정 오류로 인한 위험이 더 크다고 판단하고 있습니다.

## Linux의 멀티테넌트 환경

멀티테넌트 환경을 설정할 때 가상 머신(Virtual Machine)으로 환경을 분리할지 컨테이너로 분리할지 선택해야 합니다.

Virtual Machine을 사용하는 경우에는 하이퍼바이저가 생성하는 게스트 머신마다 각 자체의 운영 체제와 애플리케이션을 가지며, 하이퍼바이저에 의해 사용자도 분리됩니다.

컨테이너는 VM에 비해 더욱 가볍고 유연하며 스케일하기가 좋습니다. 컨테이너는 단일 호스트에서 여러 애플리케이션을 배포하고 커널 및 컨테이너 런타임을 사용하여 각 컨테이너를 동작시키는 방식으로 멀티테넌시 배포를 간소화합니다. VM은 각각 자체 커널을 가지고 있지만, 컨테이너에서 실행되는 애플리케이션은 여러 테넌트 간에 커널 하나를 공유하여 사용합니다. 

Linux에서는 네임스페이스 덕분에 여러 컨테이너가 같은 리소스를 충돌없이 동시에 사용할 수 있습니다. 컨테이너 오케스트레이션에 쿠버네티스를 사용할 경우 쿠버네티스 클러스터 하나로 멀티테넌트 환경을 설정할 수 있습니다. 이때 테넌트를 각자의 네임스페이스로 분리하고 테넌트 분리 정책을 생성할 수 있습니다.


## References
> https://www.redhat.com/ko/topics/cloud-computing/what-is-multitenancy 

